env:
##Do not define 'global' env vars here.  They cannot be used with API builds
    matrix:
      - TARGET=devo8
      - TARGET=devo10

sudo: false

addons:
  apt:
    packages:
      - build-essential
      - git
      - inkscape
      - libjpeg-dev
      - libz-dev
      - texlive
      - texlive-latex-extra
      - texlive-lang-german
      - texlive-lang-french
      - texlive-lang-spanish
      - texlive-lang-cyrillic
      - texlive-lang-hungarian

language: python

before_install:
   - openssl aes-256-cbc -K $key -iv $iv -in install_documentation.tar.enc -out install_documentation.tar -d;
         tar -xf install_documentation.tar;
         rm -f install_documentation.tar
   - echo "[https://www.transifex.com]" > .transifexrc;
         echo "hostname = https://www.transifex.com" >> .transifexrc;
         echo "password = $TX_PASSWD" >> .transifexrc;
         echo "username = api" >> .transifexrc
   - git config --global user.email "travis@travis-ci.org";
         git config --global user.name "Travis CI";
         git config --global credential.helper store;
         echo "https://$GH_TOKEN:x-oauth-basic@github.com" >> ~/.git-credentials

# command to install dependencies - this is done in Makefile already
#install: "pip install -r requirements.txt"

script:
    - tx pull -f -a
    - make html latexpdf

cache: pip

after_success:

    - git add source/locale
    - git commit -m 'Adding updated translations form Transifex'
    - git checkout -b updated_translations
    - git checkout -B master updated_translations
    - git status
    - git pull
    - git status
    - make gettext
    - sphinx-intl -c source/conf.py-intl update -p build/locale
    - tx push -s
    - export TARGET_VERSION=$(echo $TARGET | egrep -o '[[:digit:]]{1,2}')
    - export TARGET_PDF=$(echo "Deviation${TARGET_VERSION}UsersManual.pdf")
    - echo "Uploading Documentation - $TARGET_PDF"
    - utils/upload_documentation.pl -documentation -pdf build/pdf-$TARGET/$TARGET_PDF
