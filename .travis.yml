env:
##Do not define 'global' env vars here.  They cannot be used with API builds
    matrix:
      - TARGET=devo8
      - TARGET=devo10
# use new docker environment
sudo: false

#sudo: required
#dist: trusty

addons:
  apt:
    packages:
      - build-essential
      - git
      - inkscape
      - libjpeg-dev
      - libz-dev

language: python

before_install:
   - openssl aes-256-cbc -K $key -iv $iv -in install_documentation.tar.enc -out install_documentation.tar -d;
         tar -xf install_documentation.tar;
         rm -f install_documentation.tar

# command to install dependencies - this is done in Makefile already
#install: "pip install -r requirements.txt"

script:
    - make html pdf

cache: pip

after_success:
    - export TARGET_VERSION=$(echo $TARGET | egrep -o '[[:digit:]]{1,2}')
    - export TARGET_PDF=$(echo "Deviation${TARGET_VERSION}UsersManual.pdf")
    - echo "Uploading Documentation - $TARGET_PDF"
#    - utils/upload_documentation.pl -documentation -pdf build/pdf-$TARGET/$TARGET_PDF
#    - curl --verbose --url "https://www.deviationtx.com/index.php?option=com_uploadbuild&documentation&pdf";
#    - curl --verbose --url "https://www.deviationtx.com/index.php?option=com_uploadbuild" -F 'documentation' -F 'pdf' -F 'build[]=@"build/pdf-$TARGET/$TARGET_PDF"';
    - curl --verbose --url "https://www.deviationtx.com/index.php?option=com_uploadbuild" -F 'documentation' -F 'pdf';
